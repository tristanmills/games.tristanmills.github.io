<!DOCTYPE html>
<html lang="en">
<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>RetroPie Games List</title>

	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="keywords" content="">
	<meta name="author" content="Tristan Mills">

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/css/bootstrap.min.css">

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/js/bootstrap.min.js"></script>

	<style>
	.container-fluid {
		margin-top: 1rem;
	}
	ul {
		padding-left: 1rem;
		list-style: none;
	}
	li:before {
		content: '\2022';
		display: inline-block;
		width: .5rem;
		margin-right: 1rem;
	}
	li.checked:before {
		content: '\2713';
	}
	</style>

	<script>
	function filterGames(games, filters) {

		var games = jQuery.extend(true, [], games);

		for (system in games) {

			games[system].forEach(function(game, index) {

				if (filters.indexOf('multiplayer') != -1 && game.players < 2) {
					delete games[system][index];
				} else if (filters.indexOf('simultaneous-coop') != -1 && game.multiplayer['simultaneous-coop'] === false) {
					delete games[system][index];
				} else if (filters.indexOf('alternating-coop') != -1 && game.multiplayer['alternating-coop'] === false) {
					delete games[system][index];
				} else if (filters.indexOf('simultaneous-vs') != -1 && game.multiplayer['simultaneous-vs'] === false) {
					delete games[system][index];
				} else if (filters.indexOf('alternating-vs') != -1 && game.multiplayer['alternating-vs'] === false) {
					delete games[system][index];
				}

			});

			games[system] = games[system].filter(function(){return true;});

			if (games[system].length === 0) {
				games[system].push({
					'name': 'None',
					'multiplayer': {}
				})
			}
		}

		return games;

	}

	function renderGames(games) {

		$('#games').empty();

		for (system in games) {

			var html = '<h3>' + system + '</h3>';

			html += '<ul>';

			games[system].forEach(function(game) {

				var tested = '';
				var multiplayer = '';
				var simultaneous_coop = '';
				var simultaneous_vs = '';
				var alternating_coop = '';
				var alternating_vs = '';

				if (game.tested) {
					tested = ' class="checked"';
				}

				if (game.players > 1) {
					multiplayer = ' <span class="tag tag-info">Multi (' + game.players + ')</span>';
				}

				if (game.multiplayer['simultaneous-coop']) {
					simultaneous_coop = ' <span class="tag tag-success">Simo Co-Op</span>';
				}

				if (game.multiplayer['alternating-coop']) {
					alternating_coop = ' <span class="tag tag-success">Alt Co-Op</span>';
				}

				if (game.multiplayer['simultaneous-vs']) {
					simultaneous_vs = ' <span class="tag tag-danger">Simo Vs</span>';
				}

				if (game.multiplayer['alternating-vs']) {
					alternating_vs = ' <span class="tag tag-danger">Alt Vs</span>';
				}

				html += '<li' + tested + '>' + game.name + multiplayer + simultaneous_coop + alternating_coop + simultaneous_vs + alternating_vs + '</li>';

			});

			html += '</ul>';

			$('#games').append(html);

		}

	}

	jQuery(document).ready(function($) {

		$.getJSON('games.json', function(games) {

			var filtered_games = filterGames(games, []);

			renderGames(filtered_games);

			$('.filter').on('click', function(event) {

				event.preventDefault();

				$(this).toggleClass('active');

				$(this).blur();

				var filters = [];

				$('.filter.active').each(function() {
					filters.push($(this).attr('id'));
				});

				filtered_games = filterGames(games, filters);

				renderGames(filtered_games);

			});

		});

	});
	</script>

</head>
<body>

	<nav class="navbar navbar-light bg-faded">
		<a class="navbar-brand" href="/">
			<img src="https://cloud.githubusercontent.com/assets/10035308/11631694/6fa8e356-9cc0-11e5-8bce-4b8305f0fe8f.png" height="34" class="d-inline-block align-top" alt="RetroPie">
			<span>Games List</span>
		</a>
		<form class="form-inline float-xs-right">
			<a href="#" id="alternating-vs" role="button" class="filter btn btn-sm btn-outline-danger">Alt Vs</a>
			<a href="#" id="simultaneous-vs" role="button" class="filter btn btn-sm btn-outline-danger">Simo Vs</a>
			<a href="#" id="alternating-coop" role="button" class="filter btn btn-sm btn-outline-success">Alt Co-Op</a>
			<a href="#" id="simultaneous-coop" role="button" class="filter btn btn-sm btn-outline-success">Simo Co-Op</a>
			<a href="#" id="multiplayer" role="button" class="filter btn btn-sm btn-outline-info">Multi</a>
		</form>
	</nav>

	<div id="games" class="container-fluid" role="main">

		<noscript>
			<div class="alert alert-danger" role="alert">
				<span>JavaScript is disabled in your web browser. JavaScript is required use this tool. Here are the <a class="alert-link" href="http://enable-javascript.com/" target="_blank">instructions how to enable JavaScript in your web browser</a>.</span>
			</div>
		</noscript>

	</div>

</body>
</html>
